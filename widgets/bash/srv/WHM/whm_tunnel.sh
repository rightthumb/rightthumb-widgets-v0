#!/bin/bash

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# WHM/cPanel Reverse SSH Tunnel Script (Real-World Use)
# Usage: ./whm_tunnel.sh user@your-vps-ip
# Author: Hosting-Grade ğŸ› ï¸
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

REMOTE="$1"

if [[ -z "$REMOTE" ]]; then
	echo "Usage: $0 user@your-vps-ip"
	exit 1
fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Exhaustive Port List for WHM/cPanel (No Plugins)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PORTS=(
	# â”€â”€â”€â”€â”€ Core Services â”€â”€â”€â”€â”€
	2087    # WHM (SSL)
	2086    # WHM (non-SSL)
	2083    # cPanel (SSL)
	2082    # cPanel (non-SSL)
	2096    # Webmail (SSL)
	2095    # Webmail (non-SSL)
	2089    # License check

	# â”€â”€â”€â”€â”€ Web Traffic â”€â”€â”€â”€â”€
	80      # HTTP
	443     # HTTPS

	# â”€â”€â”€â”€â”€ Mail Services â”€â”€â”€â”€â”€
	25      # SMTP
	465     # SMTP (SSL)
	587     # SMTP (submission/authenticated)
	110     # POP3
	995     # POP3 (SSL)
	143     # IMAP
	993     # IMAP (SSL)

	# â”€â”€â”€â”€â”€ Database â”€â”€â”€â”€â”€
	3306    # MySQL/MariaDB

	# â”€â”€â”€â”€â”€ SSH (for rsync, Transfer Tool) â”€â”€â”€â”€â”€
	22      # SSH access

	# â”€â”€â”€â”€â”€ Optional but Common â”€â”€â”€â”€â”€
	783     # SpamAssassin (included in base installs)
)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Build the SSH Tunnel Command
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TUNNEL_CMD="ssh -N -T"

for PORT in "${PORTS[@]}"; do
	TUNNEL_CMD+=" -R $PORT:localhost:$PORT"
done

TUNNEL_CMD+=" $REMOTE"

echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "â›“ï¸  Starting WHM Reverse Tunnel to: $REMOTE"
echo "ğŸ“¡ Ports forwarded: ${#PORTS[@]}"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
eval "$TUNNEL_CMD"